<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="https://unpkg.com/htmx.org@2.0.4"></script>
	<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
	<script src="script.js"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<link rel="stylesheet" href="style.css">
	<title>Document</title>
</head>
<body class="mx-60">
	<main x-data="{ curr: null, newNoteTitle: '', newTagName: '', tagEditNoteIdx: null }">
		<template x-if="curr !== null">
			<div x-data="{ content: '' }">
				<div class="border-b border-black">
					<button x-on:click="curr = null">Back</button>
					<button class="ml-10" onclick="selectImage()">OCR</button>
				</div>
				<div class="outline-none" contentEditable="true"
					x-html="(await axios.get('/note/'+curr.Id)).data.Html"
					x-ref="content"
					@input="axios.post('/setNoteHtml', { Id: curr.Id, Html: $event.target.innerHTML })">
				</div>
			</div>
		</template>
		<template
				x-data="{ notes: [], tags: [], tagSelectionMode: false }"
				x-init="
					notes = (await axios.get('/notePreviews')).data;
					tags = (await axios.get('/tags')).data;
				" 
				x-if="curr === null">
			<div class="grid grid-cols-2 gap-2">
				<div>
					<div class="border-b border-black">
						❯ <input x-model="newNoteTitle" placeholder="New note title" type="text" name="title"></input>
						<button x-on:click="notes = (await axios.post('/newNote', { title: newNoteTitle })).data">New note</button>
					</div>
					<template x-for="n in notes">
						<div class="flex gap-1">
							<button x-on:click="curr = (await axios.get('/note/'+n.NoteId)).data" x-text="n.NoteTitle" class="flex-1 text-left"></button>
							<template x-for="t in n.tags"><span x-text="t.Name"></span></template>
							<button x-on:click="alert('TODO')">Delete note</button>
							<button x-on:click="currTagEdit = n">Add tag</button>
						</div>
					</template>
				</div>
				<div>
					<div class="border-b border-black">
						❯ <input x-model="newTagName" placeholder="New tag title" type="text" name="title"></input>
						<button x-on:click="tags = (await axios.post('/newTag', { name: newTagName })).data">New tag</button>
					</div>
					<template x-for="t in tags">
						<div>
							<template x-if="currTagEdit !== null">
								<input type="checkbox" x-model="t.Selected" x-on:click="currTagEdit.Tags = .push(t); console.log(currTagEdit)"></input>
							</template>
							<span x-text="t.Name"></span>
						</div>
					</template>
				</div>
			</div>
		</template>
	</main>
</body>
</html>
